library(tximport)
library(stringr)
library(IsoformSwitchAnalyzeR)
library(edgeR)
source("https://raw.githubusercontent.com/Fperezzavala/Functions_for_DEGs/main/R_funtions_for_DEG.R")
library(ggvenn)
library(topGO)
library(extrafont)
library(agricolae)
library(reshape2)
library(ggpubr)
library(ggplotify)
library(Cairo)

# Load data #
setwd("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Phi DEG")
working_directory <- "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Phi DEG"
library_names <- read.csv("counts/Kallisto/samples.csv", header = TRUE)
files_paths <- file.path(working_directory, "counts/Kallisto", c(library_names$countf))
names(files_paths) <- library_names$library
txi.kallisto <- tximport(files_paths, type = "kallisto", txOut = TRUE)
#head(txi.kallisto$counts)

GeneAnnotation <- 
  data.frame(
    isoform_id = unlist(rownames(txi.kallisto$counts)),
    gene_id = unlist(
      str_extract_all(
        rownames(
          txi.kallisto$counts), "AT[1|2|3|4|5|C|M]G\\w+"
      )
    )
  )
txi.kallisto$counts <-
  isoformToGeneExp(
    txi.kallisto$counts,
    isoformGeneAnnotation=GeneAnnotation,
    quiet = FALSE
  )

# DGE #
library_groups <- c()
for (i in 1:(ncol(txi.kallisto$counts)/3)){
  library_groups <- append(library_groups, c(rep(i, times = 3)))
}
DGE_matrix <- DGEList(counts=as.matrix(txi.kallisto$counts), group = library_groups)
filtered_DGE <- filterByExpr(DGE_matrix)
DGE_matrix <- DGE_matrix[filtered_DGE, , keep.lib.sizes=FALSE]
DGE_matrix %<>% calcNormFactors()
library_membership_matrix <- model.matrix(~0+group, data=DGE_matrix$samples)
colnames(library_membership_matrix) <- unique(library_names$condition)
DGE_matrix %<>% estimateDisp(library_membership_matrix)
DGE_matrix$samples$group <- library_names$condition


#   MDS Supplementary 1   #
color_handler = c()
for( counter in 1:(max(library_groups))) {
  color_handler <- append(color_handler,
                          rep(viridis(max(library_groups), end = 0.75)[counter],3))
}
mds <- plotMDS(DGE_matrix)
mds <-
  plotMDS(DGE_matrix,
          col = color_handler,
          top = dim(DGE_matrix$counts)[1],
          dim.plot = c(1,2),
          pch = 19,
          xlab = "LogFC of Dim 1",
          ylab = "LogFC of Dim 2",
          labels = rownames(library_membership_matrix),
          cex = 2
  )

# make all posible pairwise comparisons
all_pairwise_vector(DGE_matrix$samples$group) -> contrast_to_make_vector
fit_model <- glmQLFit(DGE_matrix, DGE_matrix$design)
get_pairwise_DEGs(DGE_matrix, contrast_to_make_vector, fit = fit_model, lfc = 0.26) -> data
#summary of DEG
for (i in 1:(data %>% len)){
print(summary(decideTests(data[[i]]$glmTreat)))
}

#get lists of up and downregulated genes
All_up <- NULL
All_down <- NULL
temporary_handler_1 <- NULL
temporary_handler_2 <- NULL
for (i in 1:(data %>% len)){
get.rownames(decideTests(data[[i]]$glmTreat), 1) -> temporary_handler_1
get.rownames(decideTests(data[[i]]$glmTreat), -1) -> temporary_handler_2
All_down[[data[[i]]$Comparison]] <-  temporary_handler_1
All_up[[data[[i]]$Comparison]] <- temporary_handler_2
}

#-Pi vs +Pi Figure S2 A
CairoPNG(filename = "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Sx_volcanoplot_LPvsHP.png",
         device ="cairo_png", width = 420, height = 420, units = "px")
volcano_plot(data$DEGs_in_lp_relative_to_hp$glmTreat, n_of_scales = 2, option1= "A", option2 = "G",
             scales_breaks = c(0.88,0.12), color_breaks = c(0,0.1,0.35,0.6,0.8), reverse_scales = 1)
dev.off()
#-Pi+Phi vs +Pi Figure S2 B
CairoPNG(filename = "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Sx_volcanoplot_LP+PhivsHP.png",
         device ="cairo_png", width = 420, height = 420, units = "px")
volcano_plot(data$DEGs_in_lp_phi_relative_to_hp$glmTreat, n_of_scales = 2, option1= "A", option2 = "G",
             scales_breaks = c(0.88,0.12), color_breaks = c(0,0.1,0.35,0.6,0.8), reverse_scales = 1)
dev.off()

#HPi+Phi vs HPi F1 panel A
CairoPNG(filename = "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/F2_volcanoplot_A_cairo.png",
         device ="cairo_png", width = 420, height = 420, units = "px")
volcano_plot(data$DEGs_in_hp_phi_relative_to_hp$glmTreat, n_of_scales = 2, option1= "A", option2 = "G",
             scales_breaks = c(0.88,0.12), color_breaks = c(0,0.1,0.35,0.6,0.8), reverse_scales = 1)
dev.off()
#LPi+Phi vs LPi F1 panel B
CairoPNG(filename = "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/F2_volcanoplot_B_cairo.png",
         device ="cairo_png", width = 420, height = 420, units = "px")
volcano_plot(data$DEGs_in_lp_phi_relative_to_lp$glmTreat, n_of_scales = 2, option1= "A", option2 = "G",
             scales_breaks = c(0.88,0.12), color_breaks = c(0,0.1,0.35,0.6,0.8), reverse_scales = 1)
dev.off()

#F2 panel C
CairoPNG(filename = "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/F2_volcanoplot_D_cairo.png",
         device ="cairo_png", width = 420, height = 420, units = "px")
ggvenn(list(`LPi+Phi VS LPi` = data$DEGs_in_lp_phi_relative_to_lp$glmTreat %>% decideTests() %>% get.rownames(-1),
            `HPi+Phi VS HPi` = data$DEGs_in_hp_phi_relative_to_hp$glmTreat %>% decideTests() %>% get.rownames(-1)
),
fill_alpha = 0.5,
stroke_color = "#00000033",
stroke_size = 1,
fill_color = viridis(2, end = 0.6, begin = 0.3, option = "G"),
text_color = "#000000CC",
text_size = 6
)
dev.off()

#F2 panel D
CairoPNG(filename = "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/F2_volcanoplot_C_cairo.png",
         device ="cairo_png", width = 420, height = 420, units = "px")
ggvenn(list(`LPi+Phi VS LPi` = data$DEGs_in_lp_phi_relative_to_lp$glmTreat %>% decideTests() %>% get.rownames(1),
            `HPi+Phi VS HPi` = data$DEGs_in_hp_phi_relative_to_hp$glmTreat %>% decideTests() %>% get.rownames(1)
            ),
       fill_alpha = 0.5,
       stroke_color = "#00000033",
       stroke_size = 1,
       fill_color = viridis(2, end = 0.6, begin = 0.3, option = "F"),
       text_color = "#000000CC",
       text_size = 6
       )
dev.off()

# get all pairwise GO comparisons 
go_pairwise_vector_up <- c()
go_pairwise_vector_down <- c()
for (i in 1:len(contrast_to_make_vector)){
  table <- decideTests(data[[i]]$glmTreat) %>% get.rownames(1) %>%  get_enriched_go_table()
  assign(paste0("gos_", data[[i]]$Comparison, "_up"), table)
  go_pairwise_vector_up %<>% append(paste0("gos_", data[[i]]$Comparison, "_up"))
  table <- decideTests(data[[i]]$glmTreat) %>% get.rownames(-1) %>%  get_enriched_go_table()
  assign(paste0("gos_", data[[i]]$Comparison, "_down"), table)
  go_pairwise_vector_down %<>% append(paste0("gos_", data[[i]]$Comparison, "_down"))
}

#get all pairwise Go plots
for(i in 1:len(go_pairwise_vector_up)){
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots pairwise/", go_pairwise_vector_up[i], ".png"),
           width = 600, height = 600, units = 'px')
  p <- bubbleplot(get(go_pairwise_vector_up[i]), color = "A", Terms = 25) + scale_x_discrete(position = "top") 
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
}

for(i in 1:len(go_pairwise_vector_down)){
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots pairwise/", go_pairwise_vector_down[i], ".png"),
           width = 600, height = 600, units = 'px')
  p <- bubbleplot(get(go_pairwise_vector_down[i]), color = "G", Terms = 25) +
    guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
}

# calculate Z-score of logCPM #
z_score_of_CPM <- cpm(DGE_matrix, prior.count = 2, log = TRUE)
z_score_of_CPM <- t(scale(t(z_score_of_CPM)))
z_score_of_CPM <- as.data.frame(z_score_of_CPM)
mean_z_score_of_CPM <- c()
mean_z_score_of_CPM$hp <- rowMeans(z_score_of_CPM[1:3])
mean_z_score_of_CPM$lp <- rowMeans(z_score_of_CPM[4:6])
mean_z_score_of_CPM$lp_phi <- rowMeans(z_score_of_CPM[7:9])
mean_z_score_of_CPM$hp_phi <- rowMeans(z_score_of_CPM[10:12])
mean_z_score_of_CPM <- as.data.frame(mean_z_score_of_CPM)
mean_z_score_of_CPM <- mean_z_score_of_CPM[,c("hp", "hp_phi", "lp", "lp_phi")]
colnames(mean_z_score_of_CPM) <- c("HPi", "HPi+Phi", "LPi", "LPi+Phi")
### function for biosinthesis pathways
signaling_heatmap <- function(matrix = ABA.route.matrix[c(1,2),], main_title = "ABA biosynthesis pathway", labels_row = IDs$tair_symbol) {
ComplexHeatmap::pheatmap(t(matrix),
                         cluster_rows = FALSE,
                         cluster_cols = FALSE,
                         color = c(viridis(12, option = "G", end = 0.7, begin = 0.3, direction = -1), viridis(12, option = "A", end = 0.8, begin = 0.2)),
                         border_color = NA,
                         main = main_title,
                         show_colnames = T,
                         cellwidth = 24,
                         cellheight = 24,
                         labels_row = labels_row,
                         fontfamily = "Arial",
                         fontfamily_row = "Arial",
                         fontfamily_col = "Arial",
                         fontsize_row = 20,
                         fontsize_col = 20,
                         legend = FALSE,
                         clustering_method = "average")
}

### ABA heatmaps Figure 3A the triangles were added in powerpoint acording to the next results
ABA_biosynthesis_genes <- c(
  "AT5G67030", "AT1G67080", "AT1G78390",
  "AT3G14440", "AT4G18350", "AT1G52340",
  "AT2G27150", "AT3G43600"
  )
decideTests(glmLRT(fit_model, contrast = makeContrasts(hp_phi-hp, levels=DGE_matrix$design)))[ABA_biosynthesis_genes,]

mean_z_score_of_CPM[which(rownames(mean_z_score_of_CPM) %in% ABA_biosynthesis_genes),] %>% t() -> ABA.route.matrix
ABA.route.matrix <- ABA.route.matrix[, ABA_biosynthesis_genes]
GTOGO[which(GTOGO$ensembl_gene_id %in% colnames(ABA.route.matrix)),c(1,4)] -> IDs
IDs %<>% dplyr::mutate(ID = paste0(ensembl_gene_id, ".", tair_symbol))
IDs[which(!(duplicated(IDs$ensembl_gene_id))),] -> IDs
IDs %<>% arrange(factor(ensembl_gene_id, levels = colnames(ABA.route.matrix)))

png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/ABA biosinthesis pathway.png",
    width = 300, height = 600, units = 'px')
signaling_heatmap(matrix = ABA.route.matrix[c(1,2),], main_title = "ABA biosynthesis pathway")
dev.off()

### ABA heatmaps Figure 3B
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/ABA heatmap.png",
    width = 1400, height = 600, units = 'px')
GO.heatmap(GO = "GO:0009789", mean_z_score_of_CPM[,c(1,2)], cellwidth = 20, cellheight = 50, fontsize_row = 24, fontsize_col = 18)
dev.off()

### SA heatmaps Figure 3C the triangles were added in powerpoint acording to the next results
SA_biosynthesis_genes <- c(
  "AT4G33510", "AT4G39980", "AT1G22410",
  "AT5G66120", "AT3G06350", "AT2G21940",
  "AT4G39540", "AT2G45300", "AT1G48860",
  "AT1G48850", "AT1G74710", "AT1G18870"
)

decideTests(glmLRT(fit_model, contrast = makeContrasts(hp_phi-hp, levels=DGE_matrix$design)))[SA_biosynthesis_genes,] %>% as.data.frame()

mean_z_score_of_CPM[which(rownames(mean_z_score_of_CPM) %in% SA_biosynthesis_genes),] %>% t() -> SA.route.matrix
SA.route.matrix <- SA.route.matrix[, SA_biosynthesis_genes]

GTOGO[which(GTOGO$ensembl_gene_id %in% colnames(SA.route.matrix)),c(1,4)] -> IDs
IDs %<>% dplyr::mutate(ID = paste0(ensembl_gene_id, ".", tair_symbol))
IDs[which(!(duplicated(IDs$ensembl_gene_id))),] -> IDs
IDs %<>% arrange(factor(ensembl_gene_id, levels = colnames(SA.route.matrix)))
IDs %<>% mutate(IDs, ID = case_when(
  IDs$tair_symbol == "" ~ ensembl_gene_id,
  IDs$tair_symbol != "" ~ tair_symbol
)
)
IDs$ID[11] <- "ICS1"

png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/SA biosinthesis pathway.png",
    width = 300, height = 600, units = 'px')
signaling_heatmap(matrix = SA.route.matrix[c(1,2),], main_title = "SA biosynthesis pathway", labels_row = IDs$ID)
dev.off()
### SA heatmaps Figure 3D
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/SA heatmap.png",
    width = 1400, height = 600, units = 'px')
GO.heatmap(GO = "GO:0009627", mean_z_score_of_CPM[,c(1,2)], cellwidth = 15, cellheight = 50, fontsize_row = 24, fontsize_col = 18)
dev.off()

### JA heatmaps Figure 3E the triangles were added in powerpoint acording to the next results
JA_biosynthesis_genes <- c(
  "AT1G72520", "AT3G45140", "AT5G42650",
  "AT3G25770", "AT2G06050", "AT1G20510",
  "AT4G16760", "AT4G29010", "AT2G33150"
)
decideTests(glmLRT(fit_model, contrast = makeContrasts(hp_phi-hp, levels=DGE_matrix$design)))[JA_biosynthesis_genes,] %>% as.data.frame()

mean_z_score_of_CPM[which(rownames(mean_z_score_of_CPM) %in% JA_biosynthesis_genes),] %>% t() -> JA.route.matrix
JA.route.matrix <- JA.route.matrix[, JA_biosynthesis_genes]
GTOGO[which(GTOGO$ensembl_gene_id %in% colnames(JA.route.matrix)),c(1,4)] -> IDs
IDs %<>% dplyr::mutate(ID = paste0(ensembl_gene_id, ".", tair_symbol))
IDs[which(!(duplicated(IDs$ensembl_gene_id))),] -> IDs
IDs %<>% arrange(factor(ensembl_gene_id, levels = colnames(JA.route.matrix)))
IDs %<>%   mutate(IDs, ID = case_when(
  IDs$tair_symbol == "" ~ ensembl_gene_id,
  IDs$tair_symbol != "" ~ tair_symbol
)
)
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/JA biosinthesis pathway.png",
    width = 300, height = 600, units = 'px')
signaling_heatmap(matrix = JA.route.matrix[c(1,2),], main_title = "JA biosynthesis pathway", labels_row = IDs$ID)
dev.off()

###JA heatmaps Figure 3F
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/JA heatmap.png",
    width = 1400, height = 600, units = 'px')
GO.heatmap(GO = "GO:0009867", mean_z_score_of_CPM[,c(1,2)], cellwidth = 11, cellheight = 25, fontsize_row = 20, fontsize_col = 13)
dev.off()


### local and systemic Heatmaps and rain plots F4
rain_and_heat <- function(data = mean_z_score_of_CPM, list_of_genes = local_PSR_up_low_pi_up, main ="local_PSR"){
  ComplexHeatmap::pheatmap(data[which(rownames(data) %in% c(list_of_genes)),] %>% t(),
                           legend = FALSE,
                           cluster_rows = FALSE,
                           c(viridis(12, option = "G", end = 0.8, begin = 0.2, direction = -1), viridis(12, option = "A", end = 0.8, begin = 0.2)),
                           border_color = NA,
                           show_colnames = T,
                           show_rownames = F,
                           fontsize_row = 18,
                           clustering_method = "average", 
                           main = main) -> p1
  
  plot_z_raincloud_of_genes(list_of_genes, data) -> p2
  ggarrange(p2, as.grob(p1)) -> plot_1_2
  return(plot_1_2)
}
local_PSR_up <- read.csv("genelists/PSR_Thibaud/local_PSR_up.txt", header = FALSE)
local_PSR_up_low_pi_up <- decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(local_PSR_up$V1)


png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/local_PSR.png",
    width = 600, height = 600, units = 'px')
rain_and_heat(data = mean_z_score_of_CPM, list_of_genes = local_PSR_up_low_pi_up, main ="local_PSR")
dev.off()

systemic_PSR_up <- read.csv("genelists/PSR_Thibaud/systemic_PSR_up.txt", header = FALSE)
systemic_PSR_up_low_pi_up <- decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(systemic_PSR_up$V1)
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/systemic_PSR.png",
    width = 600, height = 600, units = 'px')
rain_and_heat(data = mean_z_score_of_CPM, list_of_genes = systemic_PSR_up_low_pi_up, main ="systemic_PSR")
dev.off()


### STOP1 and PHR1/PHL1 targets Heatmaps and rain plots F5
STOP1_targets <- read.csv("genelists/STOP1_targets_cistrome_ampDAP.txt", header = FALSE)
STOP1_targets_in_low_Pi_up <- decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(STOP1_targets$V1)
downregulated_STOP_in_LPhi <- decideTests(data$DEGs_in_lp_phi_relative_to_lp$glmTreat) %>% get.rownames(-1) %>% intersect(STOP1_targets_in_low_Pi_up)
Upregulated_STOP_in_HPhi <- decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(STOP1_targets_in_low_Pi_up)
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/STOP1_targets.png",
    width = 600, height = 600, units = 'px')
#figure 5A
rain_and_heat(data = mean_z_score_of_CPM, list_of_genes = STOP1_targets_in_low_Pi_up, main ="STOP1_targets")
dev.off()


PHL1_targets <- read.csv("genelists/PHL1_targets_cistrome_DAP.txt", header = FALSE)
PHL1_targets_low_pi_up <- decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(PHL1_targets$V1)
PHR1_targets <- read.csv("genelists/PHR1_targets_CHIPseq.txt", header = FALSE)
PHR1_targets_low_pi_up <- decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(PHR1_targets$V1)
PHR1_and_PHL1_targets_low_pi_up <- union(PHL1_targets_low_pi_up, PHR1_targets_low_pi_up)
downregulated_PHR1_and_PHL1_in_Phi <- decideTests(data$DEGs_in_lp_phi_relative_to_lp$glmTreat) %>% get.rownames(-1) %>% intersect(PHR1_and_PHL1_targets_low_pi_up)
Upregulated_STOP_in_HPhi <- decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(PHR1_and_PHL1_targets_low_pi_up)
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/PHR1_and_PHL1_targets.png",
    width = 600, height = 600, units = 'px')
#figure 5b
rain_and_heat(data = mean_z_score_of_CPM, list_of_genes = PHR1_targets_low_pi_up, main ="PHR1_targets")
dev.off()

STOP1_signaling_pathway <- c("AT1G67940", "AT2G37330", "AT4G04920", "AT1G34370",
                             "AT5G01720", "AT5G27920", "AT1G08430", "AT5G23630",
                             "AT1G23010", "AT1G71040", "AT1G63245", "AT2G43790")
decideTests(glmLRT(fit_model, contrast = makeContrasts(lp_phi-lp, levels=DGE_matrix$design)))[STOP1_signaling_pathway,] %>% as.data.frame()

mean_z_score_of_CPM[which(rownames(mean_z_score_of_CPM) %in% STOP1_signaling_pathway),] %>% t() -> local.PSR.matrix
local.PSR.matrix <- local.PSR.matrix[,STOP1_signaling_pathway]
GTOGO[which(GTOGO$ensembl_gene_id %in% colnames(local.PSR.matrix)),c(1,4)] -> IDs
IDs %<>% dplyr::mutate(ID = paste0(ensembl_gene_id, ".", tair_symbol))
IDs[which(!(duplicated(IDs$ensembl_gene_id))),] -> IDs
IDs %<>% arrange(factor(ensembl_gene_id, levels = colnames(local.PSR.matrix)))
IDs %<>%   mutate(IDs, ID = case_when(
  IDs$tair_symbol == "" ~ ensembl_gene_id,
  IDs$tair_symbol != "" ~ tair_symbol
)
)
IDs$ID[3] <- "MED16"
IDs$ID[5] <- "RAE1"
IDs$ID[6] <-"RAH1"
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/local PSR pathway.png",
    width = 300, height = 600, units = 'px')
#figure 5C
signaling_heatmap(matrix = local.PSR.matrix[c(3,4),], main_title = "Local PSR signaling pathway", labels_row = IDs$ID) 
dev.off()

PHR1_signaling_pathway <- c("AT5G60410", "AT5G16760", "AT5G42810", "AT5G15070",
                            "AT3G01310", "AT4G28610", "AT5G29000", "AT3G24120",
                            "AT5G20150", "AT2G26660", "AT2G45130", "AT5G15330",
                            "AT2G33770", "AT5G43350", "AT1G02860")
decideTests(glmLRT(fit_model, contrast = makeContrasts(lp_phi-lp, levels=DGE_matrix$design)))[PHR1_signaling_pathway,] %>% as.data.frame()

mean_z_score_of_CPM[which(rownames(mean_z_score_of_CPM) %in% PHR1_signaling_pathway),] %>% t() -> systemic.PSR.matrix
systemic.PSR.matrix <- systemic.PSR.matrix[,PHR1_signaling_pathway]
GTOGO[which(GTOGO$ensembl_gene_id %in% colnames(systemic.PSR.matrix)),c(1,4)] -> IDs
IDs %<>% dplyr::mutate(ID = paste0(ensembl_gene_id, ".", tair_symbol))
IDs[which(!(duplicated(IDs$ensembl_gene_id))),] -> IDs
IDs %<>% arrange(factor(ensembl_gene_id, levels = colnames(systemic.PSR.matrix)))
IDs %<>%   mutate(IDs, ID = case_when(
  IDs$tair_symbol == "" ~ ensembl_gene_id,
  IDs$tair_symbol != "" ~ tair_symbol
)
)
IDs$ID[2] <- "ITPK1"
IDs$ID[4] <- "VIH1"
IDs$ID[5] <- "VIH2"
IDs$ID[8] <- "PHL2"
IDs$ID[13] <- "PHO2"
#figure 5D
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/systemic PSR pathway.png",
    width = 300, height = 600, units = 'px')
signaling_heatmap(matrix = systemic.PSR.matrix[c(3,4),], main_title = "Systemic PSR signaling pathway", labels_row = IDs$ID) 
dev.off()

low_Pi_genes <- list(PHR1_and_PHL1_targets_low_pi_up = c(PHR1_and_PHL1_targets_low_pi_up),
                     STOP1_targets_in_low_Pi_up = c(STOP1_targets_in_low_Pi_up),
                     systemic_PSR_up_low_pi_up = c(systemic_PSR_up_low_pi_up),
                     local_PSR_up_low_pi_up = c(local_PSR_up_low_pi_up)
)
CairoPNG("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/venn of know pathways.png",
         width = 500, height = 500, units = 'px')
ggvenn(low_Pi_genes, fill_color = viridis(4, end = 0.95, begin = 0.075, option = "E"), 
       fill_alpha = 0.6,
       stroke_color = colorspace::darken(viridis(1), 0.4),
       text_color = "#000000CC",
       text_size = 8,
       stroke_size = 1,
       show_percentage = F
)
dev.off()

#figure 5E
ggvenn(list(PHR1_PHL1_targets = PHR1_and_PHL1_targets_low_pi_up,
            STOP1_targets = STOP1_targets_in_low_Pi_up,
            PSR_Systemic_genes = systemic_PSR_up_low_pi_up,
            PSR_Local_genes = local_PSR_up_low_pi_up
),
fill_alpha = 0.55,
stroke_color = "#00000033",
stroke_size = 1,
fill_color = viridis(4, end = 0.85, begin = 0.075, option = "E"),
text_color = "#000000CC",
text_size = 6
)
# Supplementary Figure 4
non_STOP1_or_PHR1_targets_low_pi <- decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(1) %>% setdiff(union(local_PSR_up_low_pi_up,
                                                                                 union(systemic_PSR_up_low_pi_up,
                                                                                 union(PHR1_and_PHL1_targets_low_pi_up, STOP1_targets_in_low_Pi_up)
                                                                                )
                                                                                )
                                                                           )
non_STOP1_or_PHR1_targets_low_pi %>% get_enriched_go_table() -> unknow_targets_GOs
bubbleplot(unknow_targets_GOs)
write.csv(non_STOP1_or_PHR1_targets_low_pi, "genelists/other_upregulated_genes.csv")
unknow_PSR_up_high_pi_phi_up <- decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat) %>% get.rownames(1) %>% intersect(non_STOP1_or_PHR1_targets_low_pi)
unknow_PSR_up_high_pi_phi_down <- decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat) %>% get.rownames(-1) %>% intersect(non_STOP1_or_PHR1_targets_low_pi)
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/non_targets.png",
    width = 600, height = 600, units = 'px')
rain_and_heat(data = mean_z_score_of_CPM, list_of_genes = non_STOP1_or_PHR1_targets_low_pi, main = "non_STOP1_or_PHR1_targets_low_pi")
dev.off()


#figure 6 Heatmaps
zscore_up_in_low_Pi <- mean_z_score_of_CPM[decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(1),]
zscore_up_in_low_Pi %<>% mutate(phi_attenuated = LPi > `LPi+Phi`)
zscore_up_in_low_Pi_phi_attenuated <- zscore_up_in_low_Pi[zscore_up_in_low_Pi$phi_attenuated == TRUE,]
zscore_up_in_low_Pi_phi_attenuated <- intersect(rownames(zscore_up_in_low_Pi_phi_attenuated), get.rownames(decideTests(glmQLFTest(fit_model, contrast = makeContrasts(lp_phi-lp, levels=DGE_matrix$design))), -1))
zscore_up_in_low_Pi_not_attenuated <- zscore_up_in_low_Pi[zscore_up_in_low_Pi$phi_attenuated == FALSE,]
zscore_up_in_low_Pi_not_attenuated <- intersect(rownames(zscore_up_in_low_Pi_not_attenuated), get.rownames(decideTests(glmQLFTest(fit_model, contrast = makeContrasts(lp_phi-lp, levels=DGE_matrix$design))), 1))
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/Phi attenuated genes.png",
    width = 250, height = 600, units = 'px')
ComplexHeatmap::pheatmap(mean_z_score_of_CPM[zscore_up_in_low_Pi_phi_attenuated,] %>% t(),
                         cluster_rows = FALSE,
                         cluster_cols = TRUE,
                         color = c(viridis(12, option = "G", end = 0.7, begin = 0.3, direction = -1), viridis(12, option = "A", end = 0.8, begin = 0.2)),
                         border_color = NA,
                         main = "Phi attenuated genes",
                         show_colnames = T,
                         cellheight = 30,
                         #labels_row = IDs$ID,
                         fontfamily = "Arial",
                         fontfamily_row = "Arial",
                         fontfamily_col = "Arial",
                         fontsize_row = 20,
                         fontsize_col = 20,
                         legend = FALSE)
dev.off()
      
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/Phi not attenuated genes.png",
    width = 250, height = 600, units = 'px')
ComplexHeatmap::pheatmap(mean_z_score_of_CPM[zscore_up_in_low_Pi_not_attenuated,] %>% t(),
                         cluster_rows = FALSE,
                         cluster_cols = TRUE,
                         color = c(viridis(12, option = "G", end = 0.7, begin = 0.3, direction = -1), viridis(12, option = "A", end = 0.8, begin = 0.2)),
                         border_color = NA,
                         main = "Phi not attenuated genes",
                         show_colnames = T,
                         cellheight = 30,
                         #labels_row = IDs$ID,
                         fontfamily = "Arial",
                         fontfamily_row = "Arial",
                         fontfamily_col = "Arial",
                         fontsize_row = 20,
                         fontsize_col = 20,
                         legend = FALSE)
dev.off()

zscore_down_in_low_Pi <- mean_z_score_of_CPM[decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat) %>% get.rownames(-1),]
zscore_down_in_low_Pi %<>% mutate(shutdown_in_phi = LPi > `LPi+Phi`)
zscore_down_in_low_Pi_shutdown_in_phi <- zscore_down_in_low_Pi[zscore_down_in_low_Pi$shutdown_in_phi == TRUE,]
zscore_down_in_low_Pi_shutdown_in_phi <- intersect(rownames(zscore_down_in_low_Pi_shutdown_in_phi), get.rownames(decideTests(glmQLFTest(fit_model, contrast = makeContrasts(lp_phi-lp, levels=DGE_matrix$design))), -1))
zscore_down_in_low_Pi_not_shudown <- zscore_down_in_low_Pi[zscore_down_in_low_Pi$shutdown_in_phi == FALSE,]
zscore_down_in_low_Pi_not_shudown <- intersect(rownames(zscore_down_in_low_Pi_not_shudown), get.rownames(decideTests(glmQLFTest(fit_model, contrast = makeContrasts(lp_phi-lp, levels=DGE_matrix$design))), 1))
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/not_shutdown_in_phi and low Pi.png",
    width = 250, height = 600, units = 'px')
ComplexHeatmap::pheatmap(mean_z_score_of_CPM[zscore_down_in_low_Pi_shutdown_in_phi,] %>% t(),
                         cluster_rows = FALSE,
                         cluster_cols = TRUE,
                         color = c(viridis(12, option = "G", end = 0.7, begin = 0.3, direction = -1), viridis(12, option = "A", end = 0.8, begin = 0.2)),
                         border_color = NA,
                         main = "shutdown_in_phi and low Pi",
                         show_colnames = T,
                         cellheight = 30,
                         #labels_row = IDs$ID,
                         fontfamily = "Arial",
                         fontfamily_row = "Arial",
                         fontfamily_col = "Arial",
                         fontsize_row = 20,
                         fontsize_col = 20,
                         legend = FALSE
                         )
dev.off()
png("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Heatmaps/shudown_more.png",
    width = 250, height = 600, units = 'px')
ComplexHeatmap::pheatmap(mean_z_score_of_CPM[zscore_down_in_low_Pi_not_shudown,] %>% t(),
                         cluster_rows = FALSE,
                         cluster_cols = TRUE,
                         color = c(viridis(12, option = "G", end = 0.7, begin = 0.3, direction = -1), viridis(12, option = "A", end = 0.8, begin = 0.2)),
                         border_color = NA,
                         main = "zscore_down_in_low_Pi_not_shudown",
                         show_colnames = T,
                         cellheight = 30,
                         #labels_row = IDs$ID,
                         fontfamily = "Arial",
                         fontfamily_row = "Arial",
                         fontfamily_col = "Arial",
                         fontsize_row = 20,
                         fontsize_col = 20,
                         legend = FALSE
                         )
dev.off()
#figure 6 GOs bubbleplots
zscore_up_in_low_Pi_phi_attenuated  %>% get_enriched_go_table() -> gos_zscore_up_in_low_Pi_phi_attenuated
bubbleplot(gos_zscore_up_in_low_Pi_phi_attenuated, color = "G", Terms = 25)  + scale_x_discrete(position = "top") -> GOplot
CairoPNG("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/GOs lp vs phi/gos_zscore_up_in_low_Pi_phi_attenuated.png", width = 600, height = 600, units = 'px')
GOplot
dev.off()

zscore_up_in_low_Pi_not_attenuated %>% get_enriched_go_table() -> gos_zscore_up_in_low_Pi_not_attenuated
bubbleplot(gos_zscore_up_in_low_Pi_not_attenuated, color = "F", Terms = 25) -> GOs_plot
CairoPNG("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/GOs lp vs phi/gos_zscore_up_in_low_Pi_not_attenuated.png", width = 600, height = 600, units = 'px')
plot(GOs_plot)
dev.off()

zscore_down_in_low_Pi_shutdown_in_phi  %>% get_enriched_go_table() -> gos_zscore_down_in_low_Pi_shutdown_in_phi
GOs_plot <- bubbleplot(gos_zscore_down_in_low_Pi_shutdown_in_phi, color = "G", Terms = 25)  
CairoPNG("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/GOs lp vs phi/gos_zscore_up_in_low_Pi_not_shutdown_in_phi.png", width = 600, height = 600, units = 'px')
plot(GOs_plot)
dev.off()

zscore_down_in_low_Pi_not_shudown %>% get_enriched_go_table() -> gos_zscore_down_in_low_Pi_not_shudown
GOs_plot <- bubbleplot(gos_zscore_down_in_low_Pi_not_shudown, color = "F", Terms = 25) + scale_x_discrete(position = "top")
CairoPNG("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/GOs lp vs phi/gos_zscore_up_in_low_Pi_shudown_more.png", width = 600, height = 600, units = 'px')
plot(GOs_plot)
dev.off()
#supplemantary figure 5
CairoPNG(filename = "C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis/Figures/Sx_venn_up_cairo.png",
         device ="cairo_png", width = 420, height = 420, units = "px")
ggvenn(list(`LPi VS HPi` = get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1),
            `LPi+Phi VS HPi` = get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1),
            `HPi+Phi VS HPi` = get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1)
),
fill_alpha = 0.5,
stroke_color = "#00000033",
stroke_size = 1,
fill_color = viridis(3, end = 0.95, begin = 0.075),
text_color = "#000000CC",
text_size = 6
)
dev.off()




PHR1vennPHL1 <- list(PHL1_targets_low_pi_up = c(PHL1_targets_low_pi_up),
                    PHR1_targets_low_pi_up = c(PHR1_targets_low_pi_up)
                    )

ggvenn(PHR1vennPHL1, fill_color = viridis(2, end = 0.95, begin = 0.075), 
       fill_alpha = 0.6,
       stroke_color = colorspace::darken(viridis(1), 0.4),
       text_color = "#000000CC",
       text_size = 12,
       stroke_size = 1,
)


{
#lpVShp_unique_up
GOs_plot <-
  bubbleplot(
    get_enriched_go_table(
      dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1),
                     union(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1),
                           get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1)
                           )
      )
      ),
    color = "A", Terms = 25

  )
CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lpVShp_unique_up.png"),
           width = 600, height = 600, units = 'px')
p <- GOs_plot
p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
print(p)
dev.off()
#lpVShp_unique_down
GOs_plot <-
  bubbleplot(
    get_enriched_go_table(
      dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), -1),
                     union(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), -1),
                           get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), -1)
                     )
      )
      ),
      color = "G", Terms = 25
  )
CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lpVShp_unique_down.png"),
         width = 600, height = 600, units = 'px')
p <- GOs_plot
p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
print(p)
dev.off()
} #1 ok
{
  #lp_phiVSlp_unique_up
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1),
                       union(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1),
                             get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1)
                       )
        )
      ),
      color = "A", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lp_phiVSlp_unique_up.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
  #lp_phiVSlp_unique_down
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), -1),
                       union(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), -1),
                             get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), -1)
                       )
        )
      ),
      color = "G", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lp_phiVSlp_unique_down.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
} #2 ok
{
  #hp_phiVShp_unique_up
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1),
                       union(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1),
                             get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1)
                       )
        )
      ),
      color = "A", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/hp_phiVShp_unique_up.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
  #hp_phiVShp_unique_down
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), -1),
                       union(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), -1),
                             get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), -1)
                       )
        )
      ),
      color = "G", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/hp_phiVShp_unique_down.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
} #3 ok
{
  #hp_phiVShp_intersect vs LPivshp
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        (dplyr::intersect(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1), get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1)) %>%
           setdiff(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1))
         )
      ),
      color = "A", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/hp_phiVShp_intersect_LPivsHP_up.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        (dplyr::intersect(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), -1), get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), -1)) %>%
           setdiff(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), -1))
        )
      ),
      color = "G", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/hp_phiVShp_intersect_LPivsHP_down.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
  
} #4 ok
{
#lpVShp_intersecct lp_phiVSlp - hp_phiVShp_up
GOs_plot <-
  bubbleplot(
    get_enriched_go_table(
      dplyr::intersect(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1),
                       get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1)) %>%
        dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1))
    ),
    color = "A", Terms = 25
  )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lpVShp_intersect_lp_phiVSlp_up.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
#lpVShp_intersecct lp_phiVSlp - hp_phiVShp_down
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::intersect(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), -1),
                         get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), -1)) %>%
          dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), -1))
      ),
      color = "G", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lpVShp_intersect_lp_phiVSlp_down.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
} #5 ok
{
  #lpVShp_intersecct lp_phiVSlp - hp_phiVShp_up
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::intersect(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1), get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1)) %>%
          dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1))
      ),
      color = "A", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lpVShp_intersecct_lp_phiVSlp_up.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
  #lpVShp_intersecct lp_phiVSlp - hp_phiVShp_down
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::intersect(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), -1), get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), -1)) %>%
          dplyr::setdiff(get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), -1))
      ),
      color = "G", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/lpVShp_intersecct_lp_phiVSlp_down.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
} #6 ok
{
  #lpVShp_intersecct lp_phiVSlp - hp_phiVShp_up
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::intersect(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), 1),
                         dplyr::intersect(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), 1),
                                          get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), 1))
        )
      ),
      color = "A", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/intersecct_all_up.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
  #lpVShp_intersecct lp_phiVSlp - hp_phiVShp_down
  GOs_plot <-
    bubbleplot(
      get_enriched_go_table(
        dplyr::intersect(get.rownames(decideTests(data$DEGs_in_lp_phi_relative_to_hp$glmTreat), -1),
                         dplyr::intersect(get.rownames(decideTests(data$DEGs_in_hp_phi_relative_to_hp$glmTreat), -1),
                                          get.rownames(decideTests(data$DEGs_in_lp_relative_to_hp$glmTreat), -1))
        )
      ),
      color = "G", Terms = 25
    )
  CairoPNG(paste0("C:/Users/Admin/OneDrive - Texas Tech University/Phi arabidopsis", "/Figures/GOs plots Venn/intersecct_all_down.png"),
           width = 600, height = 600, units = 'px')
  p <- GOs_plot
  p <-  p + guides(colour = guide_colourbar(title.position="top", title.hjust = 0.5))
  print(p)
  dev.off()
} #7 ok


### good to this point
